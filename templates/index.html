<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Loan Default Prediction</title>
  <link rel="stylesheet" href="{{ url_for('static', filename='styles.css') }}">
</head>
<body>
  <header>
    <h1>Loan Default Prediction</h1>
  </header>
  <main>
    <section class="form-section">
      <h2>Enter Loan Details</h2>
      <form id="prediction-form" action="/predict#result" method="POST">
        <!-- Add model selection -->
        <label for="model">Choose a Model:</label>
        <select id="model" name="model" required>
          <option value="model_1">RF Model</option>
          <option value="model_2">XGB Model</option>
<!--          <option value="model_3">Stacked Model</option>-->
        </select>
      <!-- Loan Amount -->
      <label for="loan_amnt">Loan Amount</label>
      <input type="number" id="loan_amnt" name="loan_amnt" placeholder="Enter loan amount" value="15000" required>

      <!-- Term -->
      <label for="term">Term (in months)</label>
      <input type="number" id="term" name="term" placeholder="Enter term in months (e.g., 36 or 60)" value="36" required>

      <!-- Interest Rate -->
      <label for="int_rate">Interest Rate (%)</label>
      <input type="number" id="int_rate" name="int_rate" placeholder="Enter interest rate" value="13.56" step="0.01" required>

      <!-- Installment -->
      <label for="installment">Installment</label>
      <input type="number" id="installment" name="installment" placeholder="Enter installment amount" value="512.34" step="0.01" required>

      <!-- Annual Income -->
      <label for="annual_inc">Annual Income</label>
      <input type="number" id="annual_inc" name="annual_inc" placeholder="Enter annual income" value="60000" step="0.01" required>

      <!-- Debt-to-Income Ratio -->
      <label for="dti">DTI (Debt-to-Income Ratio)</label>
      <input type="number" id="dti" name="dti" placeholder="Enter DTI" value="18.2" step="0.01" required>

      <!-- Earliest Credit Line -->
      <label for="earliest_cr_line">Earliest Credit Line</label>
      <input type="text" id="earliest_cr_line" name="earliest_cr_line" placeholder="Enter date (e.g., 2005-06)" value="2005-06" required>

      <!-- Revolving Balance -->
      <label for="revol_bal">Revolving Balance</label>
      <input type="number" id="revol_bal" name="revol_bal" placeholder="Enter revolving balance" value="12000" required>

      <!-- Revolving Utilization -->
      <label for="revol_util">Revolving Utilization (%)</label>
      <input type="number" id="revol_util" name="revol_util" placeholder="Enter utilization" value="75.0" step="0.01" required>

      <!-- Mortgage Accounts -->
      <label for="mort_acc">Mortgage Accounts</label>
      <input type="number" id="mort_acc" name="mort_acc" placeholder="Enter number of accounts" value="2" required>

      <!-- Average Current Balance -->
      <label for="avg_cur_bal">Average Current Balance</label>
      <input type="number" id="avg_cur_bal" name="avg_cur_bal" placeholder="Enter average balance" value="15000" required>

      <!-- Delinquencies in Last 2 Years -->
      <label for="delinq_2yrs">Delinquencies in Last 2 Years</label>
      <input type="number" id="delinq_2yrs" name="delinq_2yrs" placeholder="Enter count" value="0" required>

      <!-- Verification Status -->
      <label for="verification_status">Verification Status</label>
      <select id="verification_status" name="verification_status" required>
        <option value="Source Verified" selected>Source Verified</option>
        <option value="Verified">Verified</option>
      </select>

      <!-- Purpose -->
      <label for="purpose">Purpose</label>
      <select id="purpose" name="purpose" required>
        <option value="debt_consolidation" selected>Debt Consolidation</option>
        <option value="credit_card">Credit Card</option>
        <option value="educational">Educational</option>
        <option value="home_improvement">Home Improvement</option>
        <option value="house">House</option>
        <option value="major_purchase">Major Purchase</option>
        <option value="medical">Medical</option>
        <option value="moving">Moving</option>
        <option value="other">Other</option>
        <option value="renewable_energy">Renewable Energy</option>
        <option value="small_business">Small Business</option>
        <option value="vacation">Vacation</option>
        <option value="wedding">Wedding</option>
      </select>

      <!-- Application Type -->
      <label for="application_type">Application Type</label>
      <select id="application_type" name="application_type" required>
        <option value="Individual" selected>Individual</option>
        <option value="Joint App">Joint App</option>
      </select>

      <!-- Home Ownership -->
      <label for="home_ownership">Home Ownership</label>
      <select id="home_ownership" name="home_ownership" required>
        <option value="RENT" selected>Rent</option>
        <option value="MORTGAGE">Mortgage</option>
        <option value="NONE">None</option>
        <option value="OTHER">Other</option>
        <option value="OWN">Own</option>
      </select>

      <!-- Sub Grade -->
      <label for="sub_grade">Sub Grade</label>
      <select id="sub_grade" name="sub_grade" required>
        <option value="B2" selected>B2</option>
        <option value="A2">A2</option>
        <option value="A3">A3</option>
        <option value="A4">A4</option>
        <option value="A5">A5</option>
        <option value="B1">B1</option>
        <option value="B3">B3</option>
        <option value="B4">B4</option>
        <option value="B5">B5</option>
        <option value="C1">C1</option>
        <option value="C2">C2</option>
        <option value="C3">C3</option>
        <option value="C4">C4</option>
        <option value="C5">C5</option>
        <option value="D1">D1</option>
        <option value="D2">D2</option>
        <option value="D3">D3</option>
        <option value="D4">D4</option>
        <option value="D5">D5</option>
        <option value="E1">E1</option>
        <option value="E2">E2</option>
        <option value="E3">E3</option>
        <option value="E4">E4</option>
        <option value="E5">E5</option>
        <option value="F1">F1</option>
        <option value="F2">F2</option>
        <option value="F3">F3</option>
        <option value="F4">F4</option>
        <option value="F5">F5</option>
        <option value="G1">G1</option>
        <option value="G2">G2</option>
        <option value="G3">G3</option>
        <option value="G4">G4</option>
        <option value="G5">G5</option>
      </select>

      <button type="submit">Predict Default</button>
    </form>
    </section>

    {% if prob_no_default is not none and prob_default is not none %}
    <section id="result" class="result-section">
      <h2>Prediction Result</h2>
      <p>Probability of No Default Risk: <strong>{{ prob_no_default }}%</strong></p>
      <p>Probability of Default Risk: <strong>{{ prob_default }}%</strong></p>
    </section>
    {% endif %}
  </main>

  <footer>
    <p>&copy; 2025 Loan Default Predictor</p>
  </footer>
<script>
document.addEventListener("DOMContentLoaded", function() {
    loadFormData();

    document.querySelectorAll("#prediction-form input, #prediction-form select").forEach(element => {
        element.addEventListener("input", saveFormData);
    });

    document.getElementById("prediction-form").addEventListener("submit", function(event) {
        event.preventDefault(); // Prevent the default form submission

        let formData = new FormData(this);

        fetch("/predict", {
            method: "POST",
            body: formData
        })
        .then(response => response.json()) // Expect JSON response
        .then(data => {
            if (data.prob_no_default !== undefined && data.prob_default !== undefined) {
                // Show the result section
                let resultSection = document.getElementById("result");
                resultSection.style.display = "block";  // Ensure it's visible

                resultSection.innerHTML = `
                    <h2>Prediction Result</h2>
                    <p>Probability of No Default Risk: <strong>${data.prob_no_default}%</strong></p>
                    <p>Probability of Default Risk: <strong>${data.prob_default}%</strong></p>
                `;

                clearFormData(); // Clear form data after showing results
            } else {
                console.error("Unexpected response format", data);
            }
        })
        .catch(error => console.error("Error:", error));
    });
});

// Save form data to localStorage
function saveFormData() {
    let formData = {};
    document.querySelectorAll("#prediction-form input, #prediction-form select").forEach(element => {
        formData[element.name] = element.value;
    });

    localStorage.setItem("loanFormData", JSON.stringify(formData));
}

// Load form data from localStorage
function loadFormData() {
    let savedData = localStorage.getItem("loanFormData");

    if (savedData) {
        savedData = JSON.parse(savedData);
        for (let key in savedData) {
            let element = document.querySelector(`[name="${key}"]`);
            if (element) {
                element.value = savedData[key];
            }
        }
    }
}

// Clear saved form data
function clearFormData() {
    localStorage.removeItem("loanFormData");
}
</script>

</body>
</html>
